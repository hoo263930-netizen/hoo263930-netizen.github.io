<!DOCTYPE html>
<html lang="ja">
<meta http-equiv="Content-Security-Policy"
  content="default-src 'self';
           connect-src 'self' https://r.jina.ai https://api.allorigins.win;
           img-src 'self' https: data:;
           script-src 'self' 'unsafe-inline' https:;
           style-src 'self' 'unsafe-inline' https:;">



  
  <style>
    :root{ --maxw:1100px; --rail:16px; }
    body{ margin:0; font-family: system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif; line-height:1.7; background:#f7d35a; }
    .wrap{ max-width:var(--maxw); margin:0 auto; padding:18px var(--rail) 60px; background:#fff; min-height:100vh; box-shadow:0 0 6px rgba(0,0,0,.05); }
    header{ display:flex; align-items:center; gap:10px; font-size:.95rem; color:#333; }
    header a{ color:#333; text-decoration:none; }
    h1{ margin:14px 0 18px; font-size:clamp(22px,3.4vw,28px); }
    /* グリッド */
    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; }
    @media (max-width:980px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width:640px){ .grid{ grid-template-columns: 1fr; } }
    /* カード */
    .card{ background:#fff; border-radius:14px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.08); }
    .card a{ display:block; color:inherit; text-decoration:none; }
    .thumb{ aspect-ratio:16/9; background:#f3f3f3; overflow:hidden; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; referrerpolicy:no-referrer; }
    .meta{ padding:.9rem .95rem 1rem; }
    .title{ font-size:1rem; margin:0 0 .35rem; line-height:1.5; }
    .date{ font-size:.85rem; color:#666; }
    /* ページャ */
    .pager{ display:flex; justify-content:center; gap:10px; margin:22px 0 0; }
    .pager button{ padding:.6rem 1rem; border-radius:10px; border:none; background:#eee; cursor:pointer; }
    .pager button[disabled]{ opacity:.5; cursor:default; }
    /* ステータス */
    .status{ color:#c00; margin:10px 0 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <header><a href="/">← トップへ戻る</a></header>
    <h1>note記事一覧</h1>
    <div id="status" class="status"></div>
    <div id="grid" class="grid" aria-live="polite"></div>
    <div class="pager">
      <button id="prev" disabled>前へ</button>
      <button id="next" disabled>次へ</button>
    </div>
  </div>



<script>
(function(){
  // ===== 設定 =====
  const RSS_ORIG = "https://note.com/loyal_dill1011/rss";
  const PROXIES = [
    (u) => `https://r.jina.ai/http/${u.replace(/^https?:\/\//,'')}`,
    (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`
  ];
  // トップ：最新3件なら 3、一覧なら 12
  const LIMIT_OR_PERPAGE = (document.getElementById("note-grid-latest") ? 3 : 12);

  // ===== 便利関数 =====
  const abs = (u) => {
    if (!u) return "";
    if (u.startsWith("http")) return u;
    if (u.startsWith("//")) return "https:" + u;
    if (u.startsWith("/"))  return "https://note.com" + u;
    return u;
  };
  const decodeHTML = (html) =>
    new DOMParser().parseFromString(html || "", "text/html").documentElement.textContent || "";
  const firstImgFromHTML = (html) => {
    const decoded = decodeHTML(html);
    const doc = new DOMParser().parseFromString(decoded, "text/html");
    const img = doc.querySelector("img");
    return img ? abs(img.getAttribute("src") || img.getAttribute("data-src") || img.getAttribute("data-original")) : "";
  };
  const fallbackImg = "https://assets.st-note.com/production/uploads/images/default/ogp.png";

  async function fetchViaProxies(url){
    let lastErr;
    for (const to of PROXIES){
      const proxied = to(url);
      try{
        const res = await fetch(proxied);
        if (!res.ok) throw new Error(`HTTP ${res.status} @ ${proxied}`);
        return await res.text();
      }catch(e){
        lastErr = e;
      }
    }
    throw lastErr || new Error("all proxies failed");
  }

  function buildCard({title, link, date, img}){
    return `
      <article class="card note-card">
        <a class="note-link" href="${link}" target="_blank" rel="noopener">
          <div class="thumb note-thumb-wrap">
            <img class="note-thumb" src="${img}" alt="${title}" loading="lazy" referrerpolicy="no-referrer">
          </div>
          <div class="meta note-meta">
            <h3 class="title note-title">${title}</h3>
            <time class="date note-date">${date}</time>
          </div>
        </a>
      </article>`;
  }

  async function main(){
    // どのページかを自動判定
    const gridTop = document.getElementById("note-grid-latest");
    const gridList = document.getElementById("grid");
    const statusBox = document.getElementById("status");

    const grid = gridTop || gridList;
    if (!grid) return;

    try{
      const xmlText = await fetchViaProxies(RSS_ORIG);
      const xml = new DOMParser().parseFromString(xmlText, "text/xml");
      const items = Array.from(xml.querySelectorAll("item"));

      // トップ（3件） or 一覧（12件×ページ1）
      const slice = items.slice(0, LIMIT_OR_PERPAGE);

      const rows = slice.map(it => {
        const title = it.querySelector("title")?.textContent ?? "";
        const link  = it.querySelector("link")?.textContent ?? "#";
        const pub   = it.querySelector("pubDate")?.textContent ?? "";
        const date  = pub ? new Date(pub).toLocaleDateString("ja-JP") : "";

        let img = it.querySelector("enclosure")?.getAttribute("url")
               || it.querySelector("media\\:thumbnail")?.getAttribute("url")
               || it.querySelector("media\\:content")?.getAttribute("url") || "";

        if (!img){
          const contentNode = it.querySelector("content\\:encoded");
          img = firstImgFromHTML(contentNode?.textContent || "");
        }
        if (!img){
          img = firstImgFromHTML(it.querySelector("description")?.textContent || "");
        }
        img = abs(img || fallbackImg);

        return buildCard({title, link, date, img});
      });

      grid.innerHTML = rows.join("");

      // 一覧ページのときだけ簡易ページャ（必要なら後で拡張）
      if (gridList){
        const next = document.getElementById("next");
        const prev = document.getElementById("prev");
        if (next) next.disabled = true;
        if (prev) prev.disabled = true;
      }

    }catch(e){
      console.error(e);
      if (statusBox) statusBox.textContent = `noteの読み込みに失敗しました：${e.message}`;
      else grid.innerHTML = `<p style="color:#c00">noteの読み込みに失敗しました：${e.message}</p>`;
    }
  }
  main();
})();
</script>






  
</body>
</html>
