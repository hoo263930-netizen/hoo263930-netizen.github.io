<!DOCTYPE html>
<html lang="ja">
<meta http-equiv="Content-Security-Policy"
  content="default-src 'self';
           connect-src 'self' https://r.jina.ai https://api.allorigins.win;
           img-src 'self' https: data:;
           script-src 'self' 'unsafe-inline' https:;
           style-src 'self' 'unsafe-inline' https:;">

  
  
  <style>
    :root{ --maxw:1100px; --rail:16px; }
    body{ margin:0; font-family: system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif; line-height:1.7; background:#f7d35a; }
    .wrap{ max-width:var(--maxw); margin:0 auto; padding:18px var(--rail) 60px; background:#fff; min-height:100vh; box-shadow:0 0 6px rgba(0,0,0,.05); }
    header{ display:flex; align-items:center; gap:10px; font-size:.95rem; color:#333; }
    header a{ color:#333; text-decoration:none; }
    h1{ margin:14px 0 18px; font-size:clamp(22px,3.4vw,28px); }
    /* グリッド */
    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:16px; }
    @media (max-width:980px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width:640px){ .grid{ grid-template-columns: 1fr; } }
    /* カード */
    .card{ background:#fff; border-radius:14px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.08); }
    .card a{ display:block; color:inherit; text-decoration:none; }
    .thumb{ aspect-ratio:16/9; background:#f3f3f3; overflow:hidden; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; referrerpolicy:no-referrer; }
    .meta{ padding:.9rem .95rem 1rem; }
    .title{ font-size:1rem; margin:0 0 .35rem; line-height:1.5; }
    .date{ font-size:.85rem; color:#666; }
    /* ページャ */
    .pager{ display:flex; justify-content:center; gap:10px; margin:22px 0 0; }
    .pager button{ padding:.6rem 1rem; border-radius:10px; border:none; background:#eee; cursor:pointer; }
    .pager button[disabled]{ opacity:.5; cursor:default; }
    /* ステータス */
    .status{ color:#c00; margin:10px 0 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <header><a href="/">← トップへ戻る</a></header>
    <h1>note記事一覧</h1>
    <div id="status" class="status"></div>
    <div id="grid" class="grid" aria-live="polite"></div>
    <div class="pager">
      <button id="prev" disabled>前へ</button>
      <button id="next" disabled>次へ</button>
    </div>
  </div>





  <script>
(async function(){
  // 1) 取得候補URL（上から順に試す）
  const CANDIDATES = [
    "https://r.jina.ai/http/https://note.com/loyal_dill1011/rss", // ← https: を含める版
    "https://r.jina.ai/http/note.com/loyal_dill1011/rss",         // ← さっきの版
    "https://api.allorigins.win/raw?url=" + encodeURIComponent("https://note.com/loyal_dill1011/rss")
  ];

  // 2) どのページか自動判定
  const grid = document.getElementById("note-grid-latest") || document.getElementById("grid");
  const statusBox = document.getElementById("status");
  const limit = (grid && grid.id === "note-grid-latest") ? 3 : 12;
  if (!grid) return;

  // 3) ユーティリティ
  const abs = (u) => !u ? "" : u.startsWith("http") ? u : u.startsWith("//") ? "https:"+u : u.startsWith("/") ? "https://note.com"+u : u;
  const decodeHTML = (h) => new DOMParser().parseFromString(h||"", "text/html").documentElement.textContent || "";
  const firstImgFromHTML = (h) => {
    const doc = new DOMParser().parseFromString(decodeHTML(h), "text/html");
    const img = doc.querySelector("img");
    return img ? abs(img.getAttribute("src") || img.getAttribute("data-src") || img.getAttribute("data-original") || (img.getAttribute("srcset")||"").split(" ")[0]) : "";
  };
  const fallbackImg = "https://assets.st-note.com/production/uploads/images/default/ogp.png";

  async function fetchFirstWorking(urls){
    let lastErr;
    for (const u of urls){
      try{
        const r = await fetch(u);
        if (!r.ok) throw new Error(`HTTP ${r.status} @ ${u}`);
        return await r.text();
      }catch(e){ lastErr = e; }
    }
    throw lastErr || new Error("all candidates failed");
  }

  try{
    // 4) RSSテキスト取得
    const xmlText = await fetchFirstWorking(CANDIDATES);

    // 5) パースしてカード描画
    const xml = new DOMParser().parseFromString(xmlText, "text/xml");
    const items = Array.from(xml.querySelectorAll("item")).slice(0, limit);

    if (!items.length){
      grid.innerHTML = '<p style="color:#666">記事が見つかりませんでした。</p>';
      return;
    }

    grid.innerHTML = "";
    for (const it of items){
      const title = it.querySelector("title")?.textContent ?? "";
      const link  = it.querySelector("link")?.textContent ?? "#";
      const pub   = it.querySelector("pubDate")?.textContent ?? "";
      const date  = pub ? new Date(pub).toLocaleDateString("ja-JP") : "";

      let img = it.querySelector("enclosure")?.getAttribute("url")
             || it.querySelector("media\\:thumbnail")?.getAttribute("url")
             || it.querySelector("media\\:content")?.getAttribute("url") || "";
      if (!img) img = firstImgFromHTML(it.querySelector("content\\:encoded")?.textContent || "");
      if (!img) img = firstImgFromHTML(it.querySelector("description")?.textContent || "");
      img = abs(img || fallbackImg);

      grid.insertAdjacentHTML("beforeend", `
        <article class="card note-card">
          <a class="note-link" href="${link}" target="_blank" rel="noopener">
            <div class="thumb note-thumb-wrap">
              <img class="note-thumb" src="${img}" alt="${title}" loading="lazy" referrerpolicy="no-referrer">
            </div>
            <div class="meta note-meta">
              <h3 class="title note-title">${title}</h3>
              <time class="date note-date">${date}</time>
            </div>
          </a>
        </article>
      `);
    }
  }catch(e){
    console.error(e);
    if (statusBox) statusBox.textContent = "noteの読み込みに失敗しました：" + e.message;
    else grid.innerHTML = '<p style="color:#c00">noteの読み込みに失敗しました：' + e.message + '</p>';
  }
})();
</script>








  
</body>
</html>
