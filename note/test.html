<section class="note-section">
  <h2 class="note-heading">📝 最新のnote記事</h2>
  <div id="note-grid"></div>
  <div class="note-actions">
    <a class="btn-more" href="https://note.com/loyal_dill1011" target="_blank" rel="noopener">もっと読む</a>
  </div>
</section>

<style>
.note-section{padding:36px 18px;background:#fafaf7}
#note-grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
.note-card{
  background:#fff;border-radius:18px;overflow:hidden;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  transition:transform .2s, box-shadow .2s;
}
.note-card:hover{transform:translateY(-4px);box-shadow:0 10px 24px rgba(0,0,0,.12)}
.note-thumb img{width:100%;height:180px;object-fit:cover;display:block;}
.note-content{padding:16px 20px;}
.note-title{font-weight:700;margin:0 0 6px;font-size:1.05rem;line-height:1.35}
.note-title a{color:#111;text-decoration:none;}
.note-title a:hover{text-decoration:underline;}
.note-meta{font-size:.86rem;color:#666;margin:0 0 10px;}
.note-desc{color:#444;line-height:1.5;margin:0;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;}
.btn-more{
  display:inline-block;margin-top:20px;padding:10px 18px;border-radius:999px;
  background:#f3b700;color:#111;text-decoration:none;
  box-shadow:0 6px 14px rgba(243,183,0,.35);
}
</style>

<script>
(async () => {
  const el = document.getElementById("note-grid");
  el.innerHTML = '<div class="note-card"><div class="note-content">読み込み中…</div></div>';

  // img抽出ヘルパー（本文HTMLから最初の<img src>を取る）
  const pickImgFromHTML = (html) => {
    if (!html) return "";
    const div = document.createElement("div");
    div.innerHTML = html;
    const im = div.querySelector("img");
    return im?.getAttribute("src") || "";
  };

  // 相対→絶対URL化（失敗時は元を返す）
  const toAbs = (u, base) => {
    try { return new URL(u, base).href; } catch { return u || ""; }
  };

  try {
    const res = await fetch(
      "https://api.rss2json.com/v1/api.json?rss_url=https://note.com/loyal_dill1011/rss"
    );
    const data = await res.json();

    const fmt = (s) => new Date(s).toLocaleDateString("ja-JP");

    const items = (data.items || []).slice(0, 3).map((item) => {
      // --- フォールバック順に候補を取る ---
      const c1 = item.thumbnail;                                       // 旧来の定番
      const c2 = item.enclosure?.link || item.enclosure?.url || "";    // 単体enclosure
      const c3 = Array.isArray(item.enclosures) && item.enclosures[0]
                 ? (item.enclosures[0].link || item.enclosures[0].url || "")
                 : "";
      const c4 = pickImgFromHTML(item.content);                        // 本文HTML内の最初の<img>
      const c5 = pickImgFromHTML(item.description);                    // 説明HTML内の最初の<img>

      let img = c1 || c2 || c3 || c4 || c5 || "";
      // 絶対URLへ（note側は基本絶対だけど保険）
      img = toAbs(img, item.link);

      const descText = (item.description || "")
        .replace(/<[^>]+>/g, "")
        .replace(/\s+/g, " ")
        .slice(0, 80);

      return {
        title: item.title,
        link: item.link,
        date: item.pubDate,
        img,
        desc: descText
      };
    });

    // 描画
    el.innerHTML = items.map(({ title, link, date, img, desc }) => {
      const dateStr = fmt(date);
      const imgPart = img
        ? `<div class="note-thumb"><img src="${img}" loading="lazy" alt=""></div>`
        : ""; // 画像なしでも崩れない
      return `
        <article class="note-card">
          ${imgPart}
          <div class="note-content">
            <h3 class="note-title"><a href="${link}" target="_blank" rel="noopener">${title}</a></h3>
            <p class="note-meta">${dateStr}</p>
            <p class="note-desc">${desc}</p>
          </div>
        </article>`;
    }).join("");

    // デバッグしたい場合は以下を一時的にON
    // console.table(items.map(i => ({title:i.title, img:i.img})));
  } catch (e) {
    console.error(e);
    el.innerHTML = "<p style='color:red'>noteの読み込みに失敗しました。</p>";
  }
})();

  .note-thumb{background:#f2f2f0}

</script>


