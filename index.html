<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>遊べるお寺プロジェクト</title>

  <style>
    :root{
      --sky:#5ac2ff; /* base blue */
      --sand:#f7ce52; /* accent yellow */
      --leaf:#36b37e; /* accent green */
      --ink:#2b2b2b;  /* dark text */
      --paper:#fff;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:'Yu Gothic','Hiragino Kaku Gothic ProN',system-ui,-apple-system,sans-serif;
      color:var(--ink);
      background:var(--paper);
    }

    /* ==== Header: 画像を切らずに横いっぱい（<img>方式） ==== */
    .site-header{ position:relative; }
    .site-header img.hero{
      display:block;
      width:100%;
      height:auto; /* トリミングしない */
    }

    /* 画像の下端にナビを重ねる（ナビ自体はコンパクト） */
    .nav-container{
      position:absolute;
      bottom:-8px;                 /* -6〜-14pxで微調整OK */
      left:50%;
      transform:translateX(-50%);
      width:100%;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .nav{ pointer-events:auto; }
    .nav ul{
      list-style:none;
      margin:0;
      padding:5px 10px;            /* タイト目 */
      display:flex;
      gap:.9rem;
      background:rgba(255,255,255,.85);
      border-radius:10px 10px 0 0;
      border:3px solid #000;
      box-shadow:0 6px 0 #000;
    }
    .nav a{
      text-decoration:none;
      color:#000;
      font-weight:800;
    }

    /* ===== Generic layout ===== */
    section{ padding:72px 20px 40px; max-width:1100px; margin:auto; }
    h2{ font-size:clamp(20px,2.8vw,28px); border-bottom:4px solid var(--sand); padding-bottom:.5rem; margin-top:0; }

    .card-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px; }
    .card{ border:3px solid #000; border-radius:18px; padding:16px; background:#fff; box-shadow:0 6px 0 #000; }
    .card img{ width:100%; height:180px; object-fit:cover; border-radius:12px; border:2px solid #000; }
    .meta{ font-size:.9rem; opacity:.8; margin-top:4px; }

    .btn{ display:inline-block; padding:10px 14px; border:3px solid #000; border-radius:12px; font-weight:800; text-decoration:none; }
    .btn-primary{ background:var(--sand); color:#000; box-shadow:0 4px 0 #000; }
    .btn-ghost{ background:#fff; color:#000; }

    footer{ background:var(--leaf); color:#fff; padding:24px 16px; text-align:center; font-size:.95rem; margin-top:32px; }

    /* ==== Simple carousel (hero gallery) ==== */
    .carousel{ max-width:1100px; margin:18px auto 0; padding:0 20px 28px; }
    .slides{ position:relative; overflow:hidden; border-radius:18px; border:3px solid #000; box-shadow:0 6px 0 #000; height:360px; }
    .slide{ position:absolute; inset:0; opacity:0; transition:opacity .8s ease; }
    .slide img{ width:100%; height:100%; object-fit:cover; display:block; }
    .slide.active{ opacity:1; }

    @media (max-width:720px){
      .nav ul{ gap:.6rem; font-size:.9rem; padding:6px 10px; }
      .slides{ height:220px; }
    }
    @media (max-width:480px){
      .nav ul{ gap:.5rem; font-size:.9rem; padding:5px 8px; }
    }
  </style>
</head>

<body>
  <!-- 画像ヘッダー（<img>で横いっぱい・切らない） & 下端ナビ -->
  <header class="site-header" id="home">
    <img class="hero" src="header.png" alt="遊べるお寺プロジェクト ヘッダー画像">
    <div class="nav-container">
      <nav class="nav">
        <ul>
          <li><a href="#home">ホーム</a></li>
          <li><a href="#about">遊べるお寺プロジェクトとは</a></li>
          <li><a href="#events">イベント</a></li>
          <li><a href="#request">ご依頼はこちら</a></li>
          <li><a href="#join">参加方法</a></li>
          <li><a href="#support">寄付・応援</a></li>
          <li><a href="#contact">お問い合わせ</a></li>
          <li><a href="#en">Luggage</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Hero carousel -->
  <div class="carousel" aria-label="フォトギャラリー">
    <div class="slides" id="heroSlides">
      <div class="slide active"><img src="images/hero1.jpg" alt="お寺の風景と交流の様子" /></div>
      <div class="slide"><img src="images/hero2.jpg" alt="ボードゲームで遊ぶ参加者" /></div>
      <div class="slide"><img src="images/hero3.jpg" alt="イベントの笑顔" /></div>
    </div>
  </div>
  <script>
    // すごく軽い自動スライド
    const slides = document.querySelectorAll('#heroSlides .slide');
    let idx = 0;
    setInterval(() => {
      slides[idx].classList.remove('active');
      idx = (idx + 1) % slides.length;
      slides[idx].classList.add('active');
    }, 5000);
  </script>

  <section id="about">
    <h2>遊べるお寺プロジェクトとは</h2>
    <p>お寺を舞台に「遊び」を通じた交流と学びを提供するプロジェクトです。世代や立場を超えて、誰もが安心してつながれる場づくりを目指しています。</p>
  </section>

  <!-- ▼▼ note の最新記事（マガジンRSS）を自動表示：画像があれば表示、なければテキストのみ ▼▼ -->
  <section id="reports">
    <h2>活動報告 - note（最新）</h2>
    <div class="card-grid" id="note-feed"></div>
    <p style="margin-top:16px">
      <a class="btn btn-ghost" id="note-more" href="https://note.com/loyal_dill1011/m/m9a97295e24a9" target="_blank" rel="noopener">noteでもっと見る</a>
    </p>
  </section>
  <!-- ▲▲ ここまで note セクション ▲▲ -->

  <section id="events">
    <h2>イベント情報</h2>
    <div class="card-grid">
      <article class="card">
        <h3>10/12(日) 森カフェ×ボードゲーム</h3>
        <p class="meta">場所：超前時（境内）｜参加費：500円</p>
        <p>木陰でお茶を飲みながら、軽いゲームで交流しましょう。初めての方歓迎！</p>
        <a class="btn btn-primary" href="#">参加申し込み</a>
      </article>
      <article class="card">
        <h3>10/26(日) 健康麻雀の日</h3>
        <p class="meta">場所：地域交流スペース｜参加費：300円</p>
        <p>点数計算は不要、やさしいルールで楽しむ日。見学だけもOKです。</p>
        <a class="btn btn-primary" href="#">参加申し込み</a>
      </article>
      <article class="card">
        <h3>11/09(日) 寺子屋・ゆる仏教トーク</h3>
        <p class="meta">場所：本堂｜参加費：投げ銭</p>
        <p>日常のモヤモヤを仏教の視点でほどく、小さな対話の時間です。</p>
        <a class="btn btn-primary" href="#">参加申し込み</a>
      </article>
    </div>
  </section>

  <section id="join">
    <h2>参加方法</h2>
    <p>「地域で一緒に遊んでみたい」「こんな活動をしてみたい」というアイデアをお待ちしています。まずはお気軽に声をかけてください。</p>
    <p><a class="btn btn-ghost" href="#">アイデア・参加の相談フォームへ</a></p>
  </section>

  <section id="support">
    <h2>寄付・応援</h2>
    <p>寄付・応援ページは現在準備中です。先行して<strong>応援メッセージ</strong>を募集しています。いただいたメッセージは承認後、サイト内でご紹介予定です。</p>
    <p><a class="btn btn-primary" href="#">応援メッセージを送る</a></p>
  </section>

  <section id="contact">
    <h2>お問い合わせ</h2>
    <p>ご依頼・ご相談はこちらからお気軽にどうぞ。</p>
    <p>Email: <a href="mailto:hoo263930@gmail.com">hoo263930@gmail.com</a></p>
  </section>

  <footer>
    <p>© 2025 遊べるお寺プロジェクト</p>
  </footer>
<script>
(async function loadNoteFeed() {
  const FEED_URL = "https://note.com/loyal_dill1011/m/m9a97295e24a9/rss";
  // キャッシュバスター付き + CORS回避
  const proxied = "https://api.allorigins.win/raw?url="
    + encodeURIComponent(FEED_URL + "?t=" + Date.now());

  const feedEl = document.getElementById("note-feed");
  feedEl.innerHTML = `<p>読み込み中…</p>`;

  // itemから最初の画像URLを拾う（enclosure → content:encoded → description）
  const pickFirstImage = (item) => {
    const enc = item.querySelector("enclosure")?.getAttribute("url");
    if (enc) return enc;

    // 名前空間付き要素（content:encoded）
    const contentNode =
      item.getElementsByTagName("content:encoded")[0] ||
      item.querySelector("encoded");
    const html = contentNode?.textContent || "";

    // content:encoded / description 内の最初の<img>
    const desc = item.querySelector("description")?.textContent || "";
    const m1 = html.match(/<img[^>]+src=["']([^"']+)["']/i);
    const m2 = desc.match(/<img[^>]+src=["']([^"']+)["']/i);
    return (m1 && m1[1]) || (m2 && m2[1]) || null;
  };

  try {
    const res = await fetch(proxied, { cache: "no-store" });
    if (!res.ok) throw new Error("feed fetch failed");
    const xml = await res.text();

    const doc = new DOMParser().parseFromString(xml, "application/xml");
    let items = Array.from(doc.querySelectorAll("item"));

    // pubDate で新しい順
    items.sort((a,b) =>
      new Date(b.querySelector("pubDate")?.textContent || 0) -
      new Date(a.querySelector("pubDate")?.textContent || 0)
    );

    items = items.slice(0, 6); // 6件表示

    const cards = items.map(it => {
      const title = it.querySelector("title")?.textContent?.trim() || "無題";
      const link  = it.querySelector("link")?.textContent?.trim() || "#";
      const pub   = new Date(it.querySelector("pubDate")?.textContent || Date.now());
      const dateJp = pub.toLocaleDateString("ja-JP");
      const imgSrc = pickFirstImage(it);

      return `
        <article class="card">
          ${imgSrc ? `<img src="${imgSrc}" alt="${title}">` : ""}
          <h3 style="margin:.5rem 0">${title}</h3>
          <p class="meta">${dateJp}｜note</p>
          <a class="btn btn-primary" href="${link}" target="_blank" rel="noopener">記事を読む</a>
        </article>
      `;
    });

    feedEl.innerHTML = cards.join("") || `<p>まだ記事がありません。</p>`;
  } catch (e) {
    console.error(e);
    feedEl.innerHTML = `<p>noteの最新記事を読み込めませんでした。時間をおいて再表示してください。</p>`;
  }
})();
</script>
